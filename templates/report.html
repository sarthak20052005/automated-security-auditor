<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Security Audit Report</title>
<style>
  body{font-family:"Segoe UI",Helvetica,Arial,sans-serif;margin:24px;color:#222;background:#fafafa;}
  h1{font-size:32px;margin-bottom:8px;color:#0d47a1}
  .summary{background:#e8f0fe;border-left:6px solid #0d47a1;padding:14px;margin-bottom:18px;border-radius:6px;}
  .score{display:inline-block;padding:6px 10px;border-radius:6px;background:#e3f2fd;margin-left:10px}
  h2{font-size:22px;border-bottom:2px solid #e0e0e0;padding-bottom:6px;color:#1565c0;margin-top:28px;}
  .good{color:#1b5e20;font-weight:700}
  .bad{color:#b71c1c;font-weight:700}
  .neutral{color:#555}
  .section{margin-bottom:24px;padding:16px;background:#fff;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.05);}
  pre{background:#f4f6f8;padding:12px;border-radius:6px;overflow:auto;font-size:13px}
  .badge{display:inline-block;padding:4px 8px;border-radius:6px;background:#e3f2fd;margin-left:8px;color:#0d47a1}
  ul{margin-top:6px;margin-left:20px;}
</style>
</head>
<body>
  <h1>Security Audit Report for {{ results['general']['url'] }}</h1>
  <div class="summary">
    <strong>Scan finished:</strong> {{ generated_at }}
    <span class="score">Header: {{ results['computed']['header_score'] }}% | Cookies: {{ results['computed']['cookie_score'] }}%</span>
    <span class="badge">Grade: {{ results['computed']['grade'].get('letter','-') }} ({{ results['computed']['grade'].get('numeric','-') }}%)</span>
  </div>

  <div class="section">
    <h2>General</h2>
    <div><strong>Server:</strong> {{ results['general'].get('server','Unknown') }}</div>
    <div><strong>sitemap.xml:</strong> {{ results['general'].get('sitemap_xml_found') }}</div>
    <div><strong>robots.txt:</strong> {{ results['general'].get('robots_txt_found') }}</div>
    {% if results['general'].get('robots_disallowed_paths') %}
      <p><strong>Disallowed paths (robots):</strong></p>
      <ul>{% for p in results['general']['robots_disallowed_paths'] %}<li><code>{{ p }}</code></li>{% endfor %}</ul>
    {% endif %}
  </div>

  <div class="section">
    <h2>HTTP Security Headers</h2>
    {% if results['headers'].get('missing') %}
      <p class="bad"><strong>Missing Headers:</strong></p>
      <ul>{% for h in results['headers']['missing'] %}<li>{{ h }}</li>{% endfor %}</ul>
    {% else %}
      <p class="good">All recommended headers present</p>
    {% endif %}
    {% if results['headers'].get('csp_weaknesses') %}
      <p class="bad"><strong>CSP Weaknesses:</strong></p><ul>{% for w in results['headers']['csp_weaknesses'] %}<li>{{ w }}</li>{% endfor %}</ul>
    {% endif %}
    {% if results['headers'].get('fingerprinting') %}
      <p class="bad"><strong>Information leakage:</strong></p><ul>{% for f in results['headers']['fingerprinting'] %}<li>{{ f }}</li>{% endfor %}</ul>
    {% endif %}
  </div>

  <div class="section">
    <h2>Cookie Security</h2>
    {% if results['cookies'].get('insecure_cookies') %}
      <p class="bad"><strong>Insecure Cookies:</strong></p>
      <ul>{% for c in results['cookies']['insecure_cookies'] %}<li>{{ c }}</li>{% endfor %}</ul>
    {% else %}
      <p class="good">All cookies appear secure (Secure + HttpOnly flags present).</p>
    {% endif %}
  </div>

  <div class="section">
    <h2>SSL/TLS</h2>
    {% if results['ssl'].get('error') %}
      <p class="bad"><strong>Error:</strong> {{ results['ssl']['error'] }}</p>
    {% else %}
      <div><strong>SSLv2:</strong> <span class="{{ 'bad' if results['ssl'].get('supports_sslv2') else 'good' }}">{{ results['ssl'].get('supports_sslv2') }}</span></div>
      <div><strong>SSLv3:</strong> <span class="{{ 'bad' if results['ssl'].get('supports_sslv3') else 'good' }}">{{ results['ssl'].get('supports_sslv3') }}</span></div>
      <div><strong>TLS 1.0:</strong> <span class="{{ 'bad' if not results['ssl'].get('supports_tls_1_0') else 'good' }}">{{ results['ssl'].get('supports_tls_1_0') }}</span></div>
      <div><strong>TLS 1.1:</strong> <span class="{{ 'bad' if not results['ssl'].get('supports_tls_1_1') else 'good' }}">{{ results['ssl'].get('supports_tls_1_1') }}</span></div>
      <div><strong>TLS 1.2:</strong> <span class="{{ 'good' if results['ssl'].get('supports_tls_1_2') else 'bad' }}">{{ results['ssl'].get('supports_tls_1_2') }}</span></div>
      <div><strong>TLS 1.3:</strong> <span class="{{ 'good' if results['ssl'].get('supports_tls_1_3') else 'bad' }}">{{ results['ssl'].get('supports_tls_1_3') }}</span></div>

      <h4>Certificate</h4>
      <pre>Subject: {{ results['computed']['ssl_cert_display']['subject'] }}
Issuer:  {{ results['computed']['ssl_cert_display']['issuer'] }}
Expires: {{ results['computed']['ssl_cert_display']['not_valid_after'] }} {% if results['computed']['ssl_cert_display']['is_expired'] %}<span class="bad">(EXPIRED)</span>{% endif %}</pre>

      {% if results['ssl'].get('weak_ciphers_found') %}
        <p class="bad"><strong>Weak ciphers:</strong></p>
        <ul>{% for c in results['ssl']['weak_ciphers_found'] %}<li>{{ c }}</li>{% endfor %}</ul>
      {% endif %}
      {% if results['ssl'].get('heartbleed_vulnerable') %}<p class="bad">Vulnerable to Heartbleed</p>{% endif %}
      {% if results['ssl'].get('robot_vulnerable') %}<p class="bad">Vulnerable to ROBOT</p>{% endif %}
    {% endif %}
  </div>

  <div class="section">
    <h2>Basic Vulnerabilities</h2>
    <div><strong>Reflected XSS:</strong>
      {% if results['vulnerabilities'].get('reflected_xss',{}).get('vulnerable') %}<span class="bad">Potentially Vulnerable</span>{% else %}<span class="good">Not Detected</span>{% endif %}
      {% if results['vulnerabilities'].get('reflected_xss',{}).get('tested_url') %}<div class="neutral">Tested URL: <code>{{ results['vulnerabilities']['reflected_xss']['tested_url'] }}</code></div>{% endif %}
    </div>

    <div><strong>Clickjacking:</strong>
      {% if results['vulnerabilities'].get('clickjacking',{}).get('vulnerable') %}<span class="bad">Potentially Vulnerable</span>
        {% if results['vulnerabilities']['clickjacking'].get('reasons') %}
          <ul>{% for r in results['vulnerabilities']['clickjacking']['reasons'] %}<li>{{ r }}</li>{% endfor %}</ul>
        {% endif %}
      {% else %}<span class="good">Not Detected</span>{% endif %}
    </div>

    <div><strong>CORS:</strong>
      {% if results['vulnerabilities'].get('cors',{}).get('issue') %}<span class="bad">Potential Issue</span>
        {% if results['vulnerabilities']['cors'].get('details') %}
          <ul>{% for d in results['vulnerabilities']['cors']['details'] %}<li>{{ d }}</li>{% endfor %}</ul>
        {% endif %}
      {% else %}<span class="good">No obvious issues detected</span>{% endif %}
    </div>
  </div>

  <div class="section">
    <h2>Extras (WHOIS / DNS / Ports)</h2>
    {% if results['extras'].get('skipped') %}
      <p class="neutral">Extras were skipped (optional modules not installed).</p>
    {% else %}
      {% if results['extras'].get('dns') %}
        <div><strong>DNS:</strong></div>
        <pre>{{ results['extras']['dns'] | tojson(indent=2) }}</pre>
      {% endif %}
      {% if results['extras'].get('ports') %}
        <div><strong>Top ports:</strong></div>
        <pre>{{ results['extras']['ports'] | tojson(indent=2) }}</pre>
      {% endif %}
      {% if results['extras'].get('whois') %}
        <div><strong>Whois:</strong></div>
        <pre>{{ results['extras']['whois'] | tojson(indent=2) }}</pre>
      {% endif %}
    {% endif %}
  </div>
</body>
</html>
